{% extends "layout.html" %}

{% block title %}- {{ g.project.name }}{% endblock %}
{% block head %}
    <script src="{{ url_for("static", filename="jquery/js/jquery-ui.js") }}"></script>
    {% if g.lang != "en" %}
    <script src="{{ url_for("static", filename="jquery/i18n/jquery.ui.datepicker-%s.js" % g.lang ) }}"></script>
    {% endif %}
{% endblock %}
{% block js %}
    // display the form when clicking on the "add bill" button
    var show_form = function(){
        $('#bill-form').show(70);
        $("#new-bill").hide();
        return false;
    }
     
    // and provide a mechanism to hide it back
    var hide_form = function(){
        $("#bill-form").hide(70);
        $("#new-bill").show();
        return false;
    }

    $('#new-bill').click(show_form);
    $('#empty-new-bill').click(show_form);
    $('#hide-bill-form').click(hide_form);
    $('#cancel-form').click(hide_form);

    // ask for confirmation before removing an user
    $('a.remove').each(function(){
        $(this).hide();
        $(this).click(function(){
            if ($(this).hasClass("confirm")){
                return true;
            }
            $(this).html("{{_("you sure?")}}");
            $(this).addClass("confirm");
            return false;
        });
    });

    // display the remove button on mouse over (and hide them per default)
    $('.balance tr').hover(function(){
        $(this).find('.remove').show();
    }, function(){
        $(this).find('.remove').hide();
    });

    $.datepicker.setDefaults({'dateFormat': 'yy-mm-dd'});
    $(".datepicker").datepicker($.datepicker.regional['{{ g.lang }}']);
{% endblock %}

{% block sidebar %}
<div class="sidebar">
<h2>{{ _("Balance") }}</h2>

    <table class="balance">
    {% set balance = g.project.get_balance() %}
    {% for member in g.project.members %}
    {% if member.activated or balance[member] != 0 %}
    <tr>
        <td>{{ member.name }}</td>
        <td class="{% if balance[member] > 0 %}positive{% elif balance[member] < 0 %}negative{% endif %}">
            {% if balance[member] > 0 %}+{% endif %}{{ balance[member] }}
        </td>
        <td> {% if member.activated %}<a class="remove" href="{{ url_for(".remove_member", member_id=member.id) }}">{{ _("delete") }}</a>{% else %}<a href="{{ url_for(".reactivate", member_id=member.id) }}">{{ _("reactivate") }}</a>{% endif %}</td>
    </tr>
    {% endif %}
    {% endfor %}
    </table>

    <form action="{{ url_for(".add_member") }}" method="post">
        {{ forms.add_member(member_form) }}
    </form>
</div>
{% endblock %}

{% block content %}
<div class="identifier">{{ _("The project identifier is") }} <a href="{{ url_for(".list_bills") }}">{{ g.project.id }}</a>, {{ _("remember it or add this page to you bookmarks!") }}</div>
<a id="new-bill" href="{{ url_for(".add_bill") }}" class="primary">{{ _("Add a new bill") }}</a>
    <form id="bill-form" action="{{ url_for(".add_bill") }}" method="post" style="display: none">
        <a id="hide-bill-form" href="#">{{ _("hide this form") }}</a>
        {{ forms.add_bill(bill_form) }}
</form>

    {% if bills.count() > 0 %}
    <table class="list_bills common-table zebra-striped">
        <thead><tr><th>{{ _("When?") }}</th><th>{{ _("Who paid?") }}</th><th>{{ _("For what?") }}</th><th>{{ _("Owers") }}</th><th>{{ _("How much?") }}</th><th>{{ _("Actions") }}</th></tr></thead>
    <tbody>
    {% for bill in bills %}
    <tr class="{{ loop.cycle("odd", "even") }}">
            <td>{{ bill.date }}</td>
            <td>{{ bill.payer }}</td>
            <td>{{ bill.what }}</td>
            <td>{% for ower in bill.owers %}{{ ower.name }} {% endfor %}</td>
            <td>{{ "%0.2f"|format(bill.amount) }} ({{ "%0.2f"|format(bill.pay_each()) }} {{ _("each") }})</td>
            <td><a href="{{ url_for(".edit_bill", bill_id=bill.id) }}">{{ _("edit") }}</a>
                <a class="delete" href="{{ url_for(".delete_bill", bill_id=bill.id) }}">{{ _("delete") }}</a></td>
    </tr>
    {% endfor %}
    </tbody>
    </table>

    {% else %}
    <p>{{ _("Nothing to list yet. You probably want to") }} <a id="empty-new-bill" href="{{ url_for(".add_bill") }}">{{ _("add a bill") }}</a> ?</p>
    {% endif %}
</div>
{% endblock %}
